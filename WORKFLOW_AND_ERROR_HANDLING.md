# 專案執行流程與錯誤處理分析

## 專案執行流程

### 1. 初始化階段
- 掃描 `projects/` 目錄下的所有專案
- 檢查每個專案是否已有 `ExecutionResult/Success/Copilot_AutoComplete_*.md` 檔案
- 建立專案狀態檔案 `projects/automation_status.json`

### 2. 專案處理階段
對每個待處理專案執行以下步驟：

#### 2.1 開啟專案
- 使用 VS Code 開啟專案資料夾
- 等待 VS Code 完全載入（預設 5 秒）

#### 2.2 清除 Copilot 記憶
- 開啟 Copilot Chat (`Ctrl+Shift+I`)
- 清除對話歷史 (`Ctrl+L`)
- 關閉 Copilot Chat (`Escape`)

#### 2.3 處理 Copilot Chat
- 開啟 Copilot Chat
- 從 `prompt.txt` 讀取並發送提示詞
- 等待 Copilot 回應（預設最多 60 秒）
- 複製回應內容
- 關閉 Copilot Chat

#### 2.4 儲存結果
- **成功時**：儲存到 `專案目錄/ExecutionResult/Success/Copilot_AutoComplete_時間戳.md`
- **失敗時**：儲存到 `專案目錄/ExecutionResult/Fail/Copilot_AutoComplete_時間戳.md`
- 建立執行日誌：`專案目錄/ExecutionResult/automation_log_時間戳.txt`

#### 2.5 關閉專案
- 智能關閉 VS Code（確保只關閉腳本開啟的實例）
- 清除 Copilot 記憶體

### 3. 完成階段
- 更新專案狀態為 `completed` 或 `failed`
- 生成執行摘要報告

## 失敗可能性與處理方式

### 1. VS Code 相關失敗

#### 1.1 VS Code 無法啟動
**原因**：
- VS Code 未正確安裝
- 可執行檔路徑錯誤
- 系統權限不足

**處理方式**：
- 檢查 `config.py` 中的 `VSCODE_EXECUTABLE` 路徑
- 確認 VS Code 已正確安裝
- 重試機制：最多 3 次

#### 1.2 專案無法開啟
**原因**：
- 專案路徑不存在
- 專案資料夾權限問題
- VS Code 工作區配置錯誤

**處理方式**：
- 跳過該專案，標記為失敗
- 記錄錯誤訊息到失敗日誌

### 2. Copilot 相關失敗

#### 2.1 Copilot Chat 無法開啟
**原因**：
- Copilot 擴充功能未安裝或未啟用
- 網路連線問題
- 快捷鍵衝突

**處理方式**：
- 重試機制：最多 3 次
- 記錄詳細錯誤訊息
- 標記專案為失敗

#### 2.2 提示詞發送失敗
**原因**：
- `prompt.txt` 檔案不存在或為空
- 剪貼簿操作失敗
- 輸入框未正確聚焦

**處理方式**：
- 檢查 `prompt.txt` 檔案
- 重試發送操作
- 記錄失敗原因

#### 2.3 等待回應超時
**原因**：
- 網路連線不穩定
- Copilot 服務繁忙
- 提示詞過於複雜

**處理方式**：
- 可調整 `COPILOT_RESPONSE_TIMEOUT` 參數
- 支援 Ctrl+C 中斷等待
- 記錄超時訊息到失敗日誌

#### 2.4 回應複製失敗
**原因**：
- 剪貼簿權限問題
- 回應內容為空
- UI 狀態異常

**處理方式**：
- 重試機制：最多 3 次
- 檢查剪貼簿內容
- 記錄複製失敗訊息

### 3. 檔案系統相關失敗

#### 3.1 結果檔案儲存失敗
**原因**：
- 磁碟空間不足
- 檔案權限問題
- 路徑過長

**處理方式**：
- 檢查磁碟空間
- 使用較短的檔名
- 記錄儲存錯誤

#### 3.2 專案目錄無法存取
**原因**：
- 路徑不存在
- 權限不足
- 網路磁碟連線問題

**處理方式**：
- 跳過該專案
- 詳細記錄錯誤原因

### 4. 系統相關失敗

#### 4.1 記憶體不足
**原因**：
- 大量專案同時處理
- VS Code 實例未正確關閉
- 系統記憶體不足

**處理方式**：
- 分批處理專案
- 強制關閉殭屍進程
- 清理臨時檔案

#### 4.2 用戶中斷 (Ctrl+C)
**原因**：
- 用戶主動中斷執行

**處理方式**：
- 立即響應中斷請求
- 優雅地關閉當前操作
- 保存已處理的結果

### 5. 網路相關失敗

#### 5.1 Copilot 服務連線失敗
**原因**：
- 網路連線中斷
- Copilot 服務故障
- 防火牆阻擋

**處理方式**：
- 檢查網路連線
- 重試機制
- 記錄連線錯誤

## 錯誤恢復策略

### 1. 自動重試
- 暫時性錯誤：自動重試最多 3 次
- 重試間隔：2-5 秒
- 退避策略：每次重試間隔遞增

### 2. 錯誤分類
- **致命錯誤**：立即中止執行
- **可恢復錯誤**：重試後繼續
- **可跳過錯誤**：跳過當前項目，繼續下一個

### 3. 狀態保存
- 實時更新專案處理狀態
- 支援中斷後繼續執行
- 保留詳細錯誤日誌

### 4. 資源清理
- 自動關閉殭屍 VS Code 進程
- 清理臨時檔案
- 釋放系統資源

## 監控與調試

### 1. 日誌系統
- **主日誌**：整體執行進度
- **專案日誌**：每個專案的詳細處理過程
- **錯誤日誌**：失敗原因和堆疊資訊

### 2. 狀態追蹤
- 即時更新處理狀態
- 記錄處理時間
- 統計成功/失敗比率

### 3. 效能監控
- 記錄每個階段的耗時
- 監控系統資源使用
- 識別效能瓶頸

## 建議的改善措施

### 1. 增強穩定性
- 增加更多檢查點
- 改善錯誤恢復邏輯
- 優化等待時間

### 2. 提升效率
- 並行處理（謹慎使用）
- 智能重試策略
- 快取機制

### 3. 改善用戶體驗
- 更詳細的進度指示
- 更清楚的錯誤訊息
- 更彈性的配置選項